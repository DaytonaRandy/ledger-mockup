<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DSCR Rate Estimator | Ledger Trade & Capital</title>
<meta name="description" content="Estimate your DSCR loan rate instantly. Enter your deal details and get a real-time quote.">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --green: #2b4a42; --green-dark: #1e3830; --green-light: #3a5f55;
  --gold: #c49a3c; --gold-dark: #b08832; --gold-light: #d4ad52;
  --white: #ffffff; --cream: #f2efe9; --cream-dark: #e8e4dc;
  --gray-100: #e0ddd6; --gray-300: #c5c1b8; --gray-500: #6b7280;
  --gray-600: #4b5563; --gray-700: #374151;
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'DM Sans',sans-serif; background:var(--cream); color:var(--green); line-height:1.6; }

/* NAV */
.nav {
  position:fixed; top:0; left:0; right:0; z-index:100;
  padding:1.25rem 3rem; display:flex; align-items:center;
  background:rgba(242,239,233,0.95); backdrop-filter:blur(12px);
  border-bottom:1px solid var(--gray-100);
}
.nav-logo {
  font-family:'Plus Jakarta Sans',sans-serif; font-weight:800; font-size:1.35rem;
  color:var(--green); text-decoration:none; letter-spacing:-0.02em; margin-right:auto;
}
.nav-logo span { color:var(--gold); }
.nav-links { display:flex; align-items:center; gap:2.5rem; list-style:none; margin-right:2rem; }
.nav-links a { color:var(--gray-600); text-decoration:none; font-size:0.9rem; font-weight:500; transition:color 0.2s; }
.nav-links a:hover { color:var(--green); }
.nav-links .dropdown { position:relative; }
.nav-links .dropdown-menu { display:none; position:absolute; top:100%; left:-1rem; padding-top:0.75rem; min-width:220px; }
.nav-links .dropdown:hover .dropdown-menu { display:block; }
.nav-links .dropdown-menu ul { background:var(--white); border:1px solid var(--gray-100); border-radius:10px; padding:0.5rem 0; list-style:none; box-shadow:0 10px 30px rgba(0,0,0,0.08); }
.nav-links .dropdown-menu li a { display:block; padding:0.6rem 1.25rem; font-size:0.85rem; }
.nav-links .dropdown-menu li a:hover { background:var(--cream); color:var(--green); }
.nav-cta {
  background:var(--gold); color:var(--white); padding:0.6rem 1.5rem; border-radius:6px;
  font-weight:700; font-size:0.85rem; text-decoration:none; transition:background 0.2s,transform 0.2s;
}
.nav-cta:hover { background:var(--gold-dark); transform:translateY(-1px); }

/* HERO */
.page-hero {
  padding:10rem 3rem 4rem; background:var(--green); text-align:center;
  position:relative; overflow:hidden;
}
.page-hero::before {
  content:''; position:absolute; top:-30%; right:-15%; width:600px; height:600px;
  background:radial-gradient(circle,rgba(196,154,60,0.08) 0%,transparent 70%);
  border-radius:50%; pointer-events:none;
}
.page-hero::after {
  content:''; position:absolute; bottom:-20%; left:-10%; width:500px; height:500px;
  background:radial-gradient(circle,rgba(196,154,60,0.05) 0%,transparent 70%);
  border-radius:50%; pointer-events:none;
}
.page-hero h1 {
  font-family:'Plus Jakarta Sans',sans-serif; font-size:3rem; font-weight:800;
  color:var(--white); letter-spacing:-0.02em; margin-bottom:1rem; position:relative;
}
.page-hero p { font-size:1.15rem; color:rgba(255,255,255,0.7); max-width:550px; margin:0 auto; line-height:1.7; position:relative; }

/* CALC */
.calc-section { padding:3rem 3rem 5rem; background:var(--cream); }
.calc-container { max-width:900px; margin:-3rem auto 0; position:relative; z-index:10; }
.calc-card {
  background:var(--white); border:1px solid var(--gray-100); border-radius:20px;
  padding:2.5rem; box-shadow:0 8px 40px rgba(0,0,0,0.06);
}
.calc-grid { display:grid; grid-template-columns:1fr 1fr; gap:1.5rem; }
.calc-group { display:flex; flex-direction:column; }
.calc-group.full { grid-column:1/-1; }
.calc-group label {
  font-size:0.75rem; font-weight:700; color:var(--green);
  margin-bottom:0.4rem; text-transform:uppercase; letter-spacing:0.08em;
}
.calc-group select, .calc-group input {
  background:var(--cream); border:1.5px solid var(--gray-100); border-radius:10px;
  padding:0.85rem 1rem; color:var(--green); font-family:'DM Sans',sans-serif;
  font-size:0.95rem; font-weight:500; outline:none; transition:border-color 0.2s,box-shadow 0.2s;
}
.calc-group select {
  appearance:none; cursor:pointer;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%232b4a42' stroke-width='2.5'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat:no-repeat; background-position:right 1rem center;
}
.calc-group select:focus, .calc-group input:focus {
  border-color:var(--gold); box-shadow:0 0 0 3px rgba(196,154,60,0.12);
}
.calc-group .help-text { font-size:0.72rem; color:var(--gray-500); margin-top:0.35rem; font-weight:500; }
.ltv-display {
  display:inline-block; background:rgba(43,74,66,0.08); color:var(--green);
  padding:0.3rem 0.75rem; border-radius:6px; font-size:0.82rem; font-weight:700; margin-top:0.4rem;
}

/* RESULT */
.calc-result {
  margin-top:2rem; padding:2.25rem; border-radius:16px;
  background:var(--green); text-align:center; position:relative; overflow:hidden;
  transition:all 0.4s ease;
}
.calc-result::before {
  content:''; position:absolute; top:-60%; right:-20%; width:400px; height:400px;
  background:radial-gradient(circle,rgba(196,154,60,0.12) 0%,transparent 70%);
  border-radius:50%; pointer-events:none;
}
.calc-result-label {
  font-size:0.72rem; font-weight:700; text-transform:uppercase; letter-spacing:0.15em;
  color:rgba(255,255,255,0.5); margin-bottom:0.5rem; position:relative;
}
.calc-result-rate {
  font-family:'Plus Jakarta Sans',sans-serif; font-size:4rem; font-weight:800;
  color:var(--gold-light); line-height:1; letter-spacing:-0.03em; position:relative;
}
.calc-result-sub { font-size:0.85rem; color:rgba(255,255,255,0.45); margin-top:0.5rem; position:relative; }
.calc-result-details {
  display:grid; grid-template-columns:repeat(4,1fr); gap:1rem;
  margin-top:1.5rem; padding-top:1.5rem; border-top:1px solid rgba(255,255,255,0.08); position:relative;
}
.calc-detail-item { text-align:center; }
.calc-detail-value { font-family:'Plus Jakarta Sans',sans-serif; font-size:1.15rem; font-weight:700; color:var(--white); }
.calc-detail-label { font-size:0.65rem; color:rgba(255,255,255,0.4); text-transform:uppercase; letter-spacing:0.1em; margin-top:0.15rem; }
.calc-result-error { font-family:'Plus Jakarta Sans',sans-serif; font-size:1.3rem; font-weight:700; color:rgba(255,255,255,0.8); line-height:1.4; position:relative; }
.calc-result-error-sub { font-size:0.85rem; color:rgba(255,255,255,0.45); margin-top:0.5rem; position:relative; }

/* CTA */
.calc-cta { text-align:center; margin-top:2rem; }
.btn-primary {
  background:var(--gold); color:var(--white); padding:0.9rem 2.25rem; border-radius:10px;
  font-family:'Plus Jakarta Sans',sans-serif; font-weight:700; font-size:0.95rem; text-decoration:none;
  display:inline-flex; align-items:center; gap:0.5rem;
  transition:all 0.2s; border:none; cursor:pointer;
}
.btn-primary:hover { background:var(--gold-dark); transform:translateY(-2px); box-shadow:0 8px 25px rgba(196,154,60,0.25); }
.calc-disclaimer {
  text-align:center; margin-top:1.5rem; font-size:0.72rem; color:var(--gray-500);
  max-width:600px; margin-left:auto; margin-right:auto; line-height:1.6;
}

/* FOOTER */
.footer { background:var(--green); padding:3rem; }
.footer-content { max-width:1200px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1.5rem; }
.footer-logo { font-family:'Plus Jakarta Sans',sans-serif; font-weight:800; font-size:1.15rem; color:var(--white); }
.footer-logo span { color:var(--gold-light); }
.footer-links { display:flex; gap:2rem; list-style:none; }
.footer-links a { color:rgba(255,255,255,0.5); text-decoration:none; font-size:0.85rem; transition:color 0.2s; }
.footer-links a:hover { color:var(--white); }
.footer-copy { width:100%; text-align:center; color:rgba(255,255,255,0.4); font-size:0.8rem; margin-top:1.5rem; padding-top:1.5rem; border-top:1px solid rgba(255,255,255,0.08); }

/* RESPONSIVE */
@media (max-width:768px) {
  .nav { padding:1rem 1.5rem; }
  .nav-links { display:none; }
  .page-hero { padding:8rem 1.5rem 3rem; }
  .page-hero h1 { font-size:2.2rem; }
  .calc-section { padding:1.5rem 1.5rem 3rem; }
  .calc-card { padding:1.5rem; }
  .calc-grid { grid-template-columns:1fr; }
  .calc-result-rate { font-size:3rem; }
  .calc-result-details { grid-template-columns:repeat(2,1fr); }
  .footer-content { flex-direction:column; text-align:center; }
  .footer-links { flex-wrap:wrap; justify-content:center; }
}
</style>
</head>
<body>

<nav class="nav">
  <a href="index.html" class="nav-logo">Ledger Trade <span>&</span> Capital</a>
  <ul class="nav-links">
    <li class="dropdown">
      <a href="#">Loan Products ▾</a>
      <div class="dropdown-menu"><ul>
        <li><a href="construction.html">Ground-Up Construction</a></li>
        <li><a href="dscr.html">DSCR Loans</a></li>
        <li><a href="bridge.html">Bridge Loans</a></li>
        <li><a href="fix-and-flip.html">Fix & Flip</a></li>
      </ul></div>
    </li>
    <li><a href="about.html">About</a></li>
    <li><a href="contact.html">Get in Touch</a></li>
  </ul>
  <a href="contact.html" class="nav-cta">Get Funded</a>
</nav>

<section class="page-hero">
  <h1>DSCR Rate Estimator</h1>
  <p>Get an instant rate estimate for your DSCR loan. Enter your deal details below and we'll find the best available program.</p>
</section>

<section class="calc-section">
  <div class="calc-container">
    <div class="calc-card">
      <div class="calc-grid">

        <div class="calc-group">
          <label>Loan Purpose *</label>
          <select id="loanPurpose" onchange="calc()">
            <option value="">Select purpose</option>
            <option value="purchase">Purchase</option>
            <option value="refi_rt">Refinance (Rate/Term)</option>
            <option value="refi_co">Refinance (Cash Out)</option>
          </select>
        </div>

        <div class="calc-group">
          <label>Property Type *</label>
          <select id="propertyType" onchange="calc()">
            <option value="">Select type</option>
            <option value="sfr">Single Family</option>
            <option value="townhome">Townhome</option>
            <option value="condo">Condo</option>
            <option value="str">Short Term Rental</option>
            <option value="2-4">2 - 4 Unit</option>
            <option value="multi">Multi Family (5+ units)</option>
          </select>
        </div>

        <div class="calc-group">
          <label>Property Value *</label>
          <input type="text" id="propVal" placeholder="$750,000" oninput="fmt(this);calc()">
          <span class="help-text">As-is value or purchase price</span>
        </div>

        <div class="calc-group">
          <label>Loan Amount *</label>
          <input type="text" id="loanAmt" placeholder="$500,000" oninput="fmt(this);calc()">
          <div id="ltvDisp"></div>
        </div>

        <div class="calc-group">
          <label>Credit Score (FICO) *</label>
          <select id="fico" onchange="calc()">
            <option value="">Select range</option>
            <option value="780">780+</option>
            <option value="760">760 - 779</option>
            <option value="740">740 - 759</option>
            <option value="720">720 - 739</option>
            <option value="700">700 - 719</option>
            <option value="680">680 - 699</option>
            <option value="660">660 - 679</option>
          </select>
        </div>

        <div class="calc-group">
          <label>Estimated DSCR</label>
          <select id="dscr" onchange="calc()">
            <option value="">Select range (optional)</option>
            <option value="high">&ge; 1.25</option>
            <option value="mid">1.00 - 1.24</option>
            <option value="low">&lt; 1.00</option>
          </select>
          <span class="help-text">Rent / PITIA (principal, interest, taxes, insurance)</span>
        </div>

        <div class="calc-group">
          <label>Prepayment Penalty *</label>
          <select id="prepay" onchange="calc()">
            <option value="">Select term</option>
            <option value="60">5 Year (best rate)</option>
            <option value="48">4 Year</option>
            <option value="36">3 Year</option>
            <option value="24">2 Year</option>
            <option value="12">1 Year</option>
            <option value="0">No Penalty</option>
          </select>
        </div>

        <div class="calc-group">
          <label>Interest Only?</label>
          <select id="io" onchange="calc()">
            <option value="no">No (fully amortizing)</option>
            <option value="yes">Yes</option>
          </select>
        </div>

        <div class="calc-group">
          <label>Collateral *</label>
          <select id="coll" onchange="calc()">
            <option value="">Select structure</option>
            <option value="single">Single Property</option>
            <option value="crossed">Crossed (multiple properties)</option>
          </select>
        </div>

      </div>

      <div class="calc-result" id="result">
        <div class="calc-result-label">Estimated Rate</div>
        <div class="calc-result-rate">--.---%</div>
        <div class="calc-result-sub">Fill in all required fields to see your estimated rate</div>
      </div>

      <div class="calc-cta">
        <a href="contact.html" class="btn-primary">Lock In Your Rate →</a>
      </div>

      <div class="calc-disclaimer">
        This is an estimate only and does not constitute a loan offer, commitment, or approval.
        Actual rates, terms, and eligibility are subject to underwriting review, property valuation,
        and market conditions at the time of lock. Contact our team for a formal quote.
      </div>
    </div>
  </div>
</section>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">Ledger Trade <span>&</span> Capital</div>
    <ul class="footer-links">
      <li><a href="construction.html">Construction</a></li>
      <li><a href="dscr.html">DSCR</a></li>
      <li><a href="bridge.html">Bridge</a></li>
      <li><a href="fix-and-flip.html">Fix & Flip</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="footer-copy">&copy; 2025 Ledger Trade &amp; Capital. All rights reserved.</div>
  </div>
</footer>

<script>
// =====================================================
// PRICING ENGINE: BASE / ADVANTAGE / INCENTIVE
// Runs all three, returns lowest rate
// =====================================================

const T = 101.0; // target par
function li(ltv) {
  if(ltv<=.50)return 0;if(ltv<=.55)return 1;if(ltv<=.60)return 2;
  if(ltv<=.65)return 3;if(ltv<=.70)return 4;if(ltv<=.75)return 5;
  if(ltv<=.80)return 6;return-1;
}
function fr(pt,adj){for(let i=pt.length-1;i>=0;i--)if((pt[i][1]+adj)>=T)return pt[i][0];return null;}
function pv(s){return parseFloat(s.replace(/[^0-9.]/g,''))||0;}
function fmt(e){let v=e.value.replace(/[^0-9]/g,'');if(v){e.value='$'+parseInt(v).toLocaleString('en-US');}}

// ─── ADVANTAGE (Single Property Program) ───
const AP=[
  [8.625,107.889],[8.5,107.668],[8.375,107.416],[8.25,107.162],[8.125,106.907],[8.0,106.634],
  [7.875,106.341],[7.75,106.022],[7.625,105.699],[7.5,105.352],[7.375,104.988],[7.25,104.598],
  [7.125,104.17],[7.0,103.728],[6.875,103.229],[6.75,102.694],[6.625,102.107],[6.5,101.489],
  [6.375,100.841],[6.25,100.162],[6.125,99.442],[6.0,98.702]
];
const AF={
  purchase:{780:[1,1,.75,.75,.25,0,-.75],760:[.75,.75,.5,.25,0,-.5,-1.25],740:[.75,.75,.25,0,-.25,-1,-1.75],720:[.5,.5,0,-.25,-.75,-1.5,-2.5],700:[.25,.25,-.25,-.75,-1.25,-2.25,-3.25],680:[0,0,-.5,-1.25,-1.75,-2.75,null],660:[-.25,-.25,-1,-1.75,-2.5,null,null]},
  refi_rt:{780:[1,1,.75,.75,.25,0,-.75],760:[.75,.75,.5,.25,0,-.5,-1.25],740:[.75,.75,.25,0,-.25,-1,-1.75],720:[.5,.5,0,-.25,-.75,-1.5,-2.5],700:[.25,.25,-.25,-.75,-1.25,-2.25,-3.25],680:[0,0,-.5,-1.25,-1.75,-2.75,null],660:[-.25,-.25,-1,-1.75,-2.5,null,null]},
  refi_co:{780:[.75,.75,.5,.25,-.5,-1.5,null],760:[.5,.5,.25,-.25,-.75,-2,null],740:[.5,.5,0,-.5,-1,-2.5,null],720:[.25,.25,-.25,-.75,-1.5,-3,null],700:[0,0,-.5,-1.25,-2,-3.75,null],680:[-.25,-.25,-.75,-1.75,-2.5,null,null],660:[-.5,-.5,-1.25,-2.25,-3,null,null]}
};
const APT={sfr:[0,0,0,0,0,0,0],townhome:[0,0,0,0,0,0,0],condo:[0,0,0,0,0,0,0],str:[0,0,0,0,0,0,0],"2-4":[-.5,-.5,-.75,-1,-1.25,-1.5,-2],multi:[-4.5,-4.5,-5,-5.5,-6,-6.5,null]};
const AIO=[-.25,-.25,-.25,-.5,-.5,-.5,null];
function ala(a){if(a<=150000)return-1;if(a<=1e6)return-.5;if(a<=1.5e6)return-.5;if(a<=2e6)return-1.5;if(a<=2.5e6)return-1.5;return null;}
const AD={low:[0,0,-.25,-.25,-.25,-.5,-.75],mid:[0,0,0,0,0,0,0],high:[.25,.25,.25,.25,.25,.25,.25]};
const APP={0:-2,12:-1.5,24:0,36:1,48:1,60:1.5};

function runAdv(pur,pt,i,f,amt,d,pp,io){
  let a=AF[pur]?.[f]?.[i];if(a==null)return null;
  let b=APT[pt]?.[i];if(b==null)return null;
  let c=0;if(io=='yes'){c=AIO[i];if(c==null)return null;}
  let e=ala(amt);if(e==null)return null;
  let g=d?AD[d]?.[i]||0:0;
  let h=APP[pp]||0;
  let r=fr(AP,a+b+c+e+g+h);
  return r?{rate:r,prog:'Advantage'}:null;
}

// ─── BASE (Crossed Collateral Program) ───
const BP=[
  [9.125,108.625],[9,108.375],[8.875,108.125],[8.75,107.875],[8.625,107.625],[8.5,107.375],
  [8.375,107.125],[8.25,106.875],[8.125,106.625],[8,106.375],[7.875,106.125],[7.75,105.875],
  [7.625,105.625],[7.5,105.375],[7.375,104.875],[7.25,104.625],[7.125,104.375],[7,104],
  [6.875,103.375],[6.75,102.875],[6.625,102.375],[6.5,101.75],[6.375,101],[6.25,100.375],
  [6.125,99.75],[6,99.125]
];
const BFS={// single property FICO for Base
  760:[1,1,1,1,.75,.125,-.625],740:[1,1,.875,.875,.375,-.125,-1.375],
  720:[.75,.75,.625,.5,0,-.75,-2.625],700:[.125,0,-.375,-.625,-1.125,-1.25,-3.5],
  680:[-.25,-.375,-.875,-1.375,-2.125,-3.25,-5.5],660:[-.875,-1.25,-2,-2.625,-3,-4.25,null]
};
const BFC={// crossed FICO for Base
  760:[.875,.875,.875,.875,.625,0,null],740:[.875,.875,.75,.75,.25,-.25,null],
  720:[.625,.625,.5,.375,-.125,-.875,null],700:[0,-.125,-.5,-.75,-1.25,null,null],
  680:[-.375,-.5,-1,-1.5,-2.25,null,null]
};
const BPT={sfr:[0,0,0,0,0,0,0],townhome:[0,0,0,0,0,0,0],condo:[-.25,-.25,-.25,-.25,-.5,-.5,-.5],str:[-1.25,-1.25,-1.5,-1.75,-2,-2.5,null],"2-4":[-.125,-.125,-.125,-.375,-.75,-1,-2],multi:[-2.5,-2.5,-3.75,-4,-5.75,-6,null]};
const BIO=[-.25,-.25,-.25,-.25,-.25,-.5,null];
const BRT=[0,0,-.25,-.625,-1,-1.625,-2.125];
const BCO=[0,0,-.25,-.625,-1,-1.625,null];
function bla(a,i,x){
  if(a<150000)return[-1,-1,-1,-1.5,-1.5,-1.5,-1.75][i];
  if(a<250000)return[0,0,0,0,-.125,-.125,-.25][i];
  if(a<=1e6)return 0;
  if(a<=1.5e6)return[-.125,-.125,-.25,-.25,-.375,-.5,-1.5][i];
  if(a<=2e6)return[-.125,-.125,-.25,-.375,-.5,-1.5,-2.5][i];
  if(a<=2.5e6){
    if(x)return[-.125,-.125,-.25,-.25,-.375,-.5,null][i];
    return[-.375,-.375,-.375,-.5,-.75,null,null][i];
  }
  if(x)return[-.125,-.125,-.25,-.25,-.375,-.5,null][i];
  return[-.375,-.375,-.375,-.5,-.75,null,null][i];
}
const BD={low:[-1,-1,-1.25,-1.5,-1.75,-2,null],mid:[-.5,-.5,-.5,-.5,-.5,-.5,-.5],high:[.25,.25,.25,.25,.25,.375,.5]};
const BPP={0:[-1.5,-1.5,-1.5,-1.5,-1.5,-1.5,-1.5],12:[-1,-1,-1,-1,-1,-1,-1],24:[-.5,-.5,-.5,-.5,-.5,-.5,-.5],36:[0,0,0,0,0,0,0],48:[.25,.25,.25,.25,.25,.25,.25],60:[.5,.5,.5,.5,.5,.5,.5]};

function runBase(pur,pt,i,f,amt,d,pp,io,xd){
  let fk=f;if(fk=='780')fk='760';
  let fg=xd?BFC:BFS;
  let a=fg[fk]?.[i];if(a==null)return null;
  let b=BPT[pt]?.[i];if(b==null)return null;
  let c=0;if(io=='yes'){c=BIO[i];if(c==null)return null;}
  let rf=0;
  if(pur=='refi_rt'){rf=BRT[i];if(rf==null)return null;}
  if(pur=='refi_co'){rf=BCO[i];if(rf==null)return null;}
  let e=bla(amt,i,xd);if(e==null)return null;
  let g=d?(BD[d]?.[i]??0):0;if(g==null)return null;
  let h=BPP[pp]?.[i]??0;if(h==null)return null;
  let r=fr(BP,a+b+c+rf+e+g+h);
  return r?{rate:r,prog:'Base'}:null;
}

// ─── INCENTIVE (marked NOT ACTIVE in sheet but including for completeness) ───
const IP=[
  [8.75,105.785],[8.625,105.535],[8.5,105.285],[8.375,105.035],[8.25,104.785],
  [8.125,104.504],[8,104.191],[7.875,103.879],[7.75,103.566],[7.625,103.254],
  [7.5,102.879],[7.375,102.504],[7.25,102.066],[7.125,101.629],[7,101.129],
  [6.875,100.629],[6.75,100.066],[6.625,99.504],[6.5,98.879],[6.375,98.254],
  [6.25,97.566],[6.125,96.878],[6,96.191],[5.875,95.441]
];
const IFS={// single FICO
  780:[.875,.625,.5,.375,-.125,-.625,-1.5],760:[.875,.625,.375,0,-.375,-.875,-1.75],
  740:[.75,.5,.25,-.125,-.5,-1,-1.875],720:[.625,.375,.125,-.25,-.75,-1.125,-2.125],
  700:[.5,.125,-.125,-.625,-1.25,-2.5,null],680:[.125,-.25,-.75,-2,-3.125,-3.5,null],
  660:[-.125,-.5,-1,-2.25,-3.375,null,null]
};
const IFC={// crossed FICO
  780:[.875,.625,.5,.125,-.375,-.875,null],760:[.875,.625,.375,-.125,-.5,-1,null],
  740:[.75,.5,.25,-.125,-.5,-1,null],720:[.625,.375,.125,-.25,-.75,-1.125,null],
  700:[.5,.125,-.125,-.625,-1.25,-2.5,null],680:[.25,-.125,-.5,-1.75,-2.75,-3.125,null]
};
const IPT_S={sfr:[0,0,0,0,0,0,0],townhome:[0,0,0,0,0,0,0],condo:[-.125,-.125,-.25,-.25,-.375,-.5,-.75],str:[0,0,0,0,0,0,0],"2-4":[-.25,-.25,-.5,-.5,-.5,-.625,-.875],multi:null};
const IST={tier1:0}; // state tier: tier1 states = 0, others = +0.25
const IIO=[-.125,-.125,-.25,-.25,-.5,-.625,null];
const ICO=[-.5,-.5,-.5,-.75,-1.125,-1.5,null];
function ila(a,i,xd){
  if(a<250000)return[0,0,0,0,0,-.375,-.5][i];
  if(a<=2e6)return[-.125,-.125,-.125,-.25,-.25,-.375,-.375][i];
  if(xd){
    if(a<=1e6)return[0,0,0,0,0,0,null][i];
    if(a<=2.5e6)return[-.125,-.125,-.125,-.25,-.25,-.375,null][i];
    if(a<=3e6)return[-.25,-.25,-.25,-.375,-.375,-.5,null][i];
  }
  return null;
}
const IDD={low:[-.625,-.75,-.75,-.75,-.875,-1,null],mid:[0,0,0,0,0,0,0],high:[.375,.375,.375,.375,.375,.375,.375]};
const IPP={0:[-1.125,-1.125,-1.125,-1.125,-1.125,-1.125,-1.125],12:[-.75,-.75,-.75,-.75,-.75,-.75,-.75],24:[-.375,-.375,-.375,-.375,-.375,-.375,-.375],36:[0,0,0,0,0,0,0],48:[.5,.5,.5,.5,.5,.5,.5],60:[1,1,1,1,1,1,1]};

function runInc(pur,pt,i,f,amt,d,pp,io,xd){
  if(pt=='multi')return null; // multi not eligible in incentive
  let fg=xd?IFC:IFS;
  let a=fg[f]?.[i];if(a==null)return null;
  let ptg=IPT_S[pt]?.[i]??0;if(ptg==null)return null;
  // State tier: assume tier 1 (0 adj) since we don't ask state
  let c=0;if(io=='yes'){c=IIO[i];if(c==null)return null;}
  let rf=0;
  if(pur=='refi_co'){rf=ICO[i];if(rf==null)return null;}
  let e=ila(amt,i,xd);if(e==null)return null;
  let g=d?(IDD[d]?.[i]??0):0;if(g==null)return null;
  let h=IPP[pp]?.[i]??0;
  let r=fr(IP,a+ptg+c+rf+e+g+h);
  return r?{rate:r,prog:'Incentive'}:null;
}

// ─── MAIN ───
function calc(){
  const pur=document.getElementById('loanPurpose').value;
  const pt=document.getElementById('propertyType').value;
  const val=pv(document.getElementById('propVal').value);
  const amt=pv(document.getElementById('loanAmt').value);
  const f=document.getElementById('fico').value;
  const d=document.getElementById('dscr').value;
  const pp=document.getElementById('prepay').value;
  const io=document.getElementById('io').value;
  const cl=document.getElementById('coll').value;

  const ld=document.getElementById('ltvDisp');
  if(val>0&&amt>0){ld.innerHTML='<span class="ltv-display">LTV: '+(amt/val*100).toFixed(1)+'%</span>';}else{ld.innerHTML='';}

  if(!pur||!pt||!val||!amt||!f||pp===''||!cl){showDef();return;}

  const ltv=amt/val;
  const i=li(ltv);
  if(i===-1){showErr("LTV exceeds 80%","Maximum LTV for DSCR loans is 80%. Reduce loan amount or increase property value.");return;}
  if(amt<100000){showErr("Below minimum","Our DSCR loans start at $150,000.");return;}

  const xd=cl==='crossed';

  // Run all three programs
  const results=[
    runAdv(pur,pt,i,f,amt,d,pp,io),
    runBase(pur,pt,i,f,amt,d,pp,io,xd),
    runInc(pur,pt,i,f,amt,d,pp,io,xd)
  ].filter(r=>r&&r.rate);

  if(!results.length){
    showErr("Not available","This combination isn't available. Try adjusting LTV, FICO, or property type.");return;
  }

  // Pick the lowest rate (best for borrower)
  results.sort((a,b)=>a.rate-b.rate);
  const best=results[0];

  showRes(best.rate,best.prog,ltv,amt,pp);
}

function showDef(){
  document.getElementById('result').innerHTML=`
    <div class="calc-result-label">Estimated Rate</div>
    <div class="calc-result-rate">--.---%</div>
    <div class="calc-result-sub">Fill in all required fields to see your estimated rate</div>`;
}
function showRes(r,pg,ltv,amt,pp){
  const pl={0:'None',12:'1 Year',24:'2 Year',36:'3 Year',48:'4 Year',60:'5 Year'}[pp]||'';
  document.getElementById('result').innerHTML=`
    <div class="calc-result-label">Estimated Rate</div>
    <div class="calc-result-rate">${r.toFixed(3)}%</div>
    <div class="calc-result-sub">30-Year Fixed DSCR Loan</div>
    <div class="calc-result-details">
      <div class="calc-detail-item"><div class="calc-detail-value">${(ltv*100).toFixed(1)}%</div><div class="calc-detail-label">LTV</div></div>
      <div class="calc-detail-item"><div class="calc-detail-value">$${(amt/1000).toFixed(0)}K</div><div class="calc-detail-label">Loan Amount</div></div>
      <div class="calc-detail-item"><div class="calc-detail-value">${pl}</div><div class="calc-detail-label">Prepay</div></div>
      <div class="calc-detail-item"><div class="calc-detail-value">${pg}</div><div class="calc-detail-label">Program</div></div>
    </div>`;
}
function showErr(t,m){
  document.getElementById('result').innerHTML=`
    <div class="calc-result-error">${t}</div>
    <div class="calc-result-error-sub">${m}</div>`;
}
</script>
</body>
</html>
